<html>
<head>
<title>SVG Grid</title>

<script src="/ext/snap.svg/dist/snap.svg.js"></script>

<style>
    body {
        position: relative;
        background-color: #333;
        margin: 20px 100px;
        color: white;
    }
    .svg-border {
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        border: 2px solid black;
    }
    svg {
        box-sizing: border-box;
    }
    svg line {
        fill: none;
        stroke-width: 1;
    }
</style>

</head>

<body>

<div class="svg-border">
    <svg id="svg" width="100%" height="100%" shape-rendering="crispEdges"></svg>
</div>

<script>
var snap, xaxis, yaxis, label;
var camera = {
    position: { x:0, y:0 },
    scale: 1.0,
};

document.addEventListener( "DOMContentLoaded", function(){
    document.removeEventListener( "DOMContentLoaded", arguments.callee, false );
    var svg = document.getElementById("svg");
    var rect = svg.getBoundingClientRect();
    var width = rect.width;
    var height = rect.height;
    var lastClientX, lastClientY;

    //
    snap = Snap("#svg");
    var txtPos = snap.text( 10, 20, "camera position: 0.0, 0.0");
    txtPos.attr({ fill: "white" });
    var txtScale = snap.text( 10, 40, "camera scale: 1.0");
    txtScale.attr({ fill: "white" });

    var updateMouseMove = function (event) {
        var dx = event.clientX - lastClientX;
        var dy = event.clientY - lastClientY;

        lastClientX = event.clientX;
        lastClientY = event.clientY;

        camera.position.x = camera.position.x + dx;
        camera.position.y = camera.position.y + dy;

        txtPos.attr({ 
            text: "camera position: " + camera.position.x + ", " + camera.position.y 
        });

        event.stopPropagation();
    };
    var mouseMoveHandle = updateMouseMove.bind(this);
    var mouseUpHandle = (function(event) {
        document.removeEventListener('mousemove', mouseMoveHandle);
        document.removeEventListener('mouseup', mouseUpHandle);
        event.stopPropagation();
    }).bind(this);
    svg.addEventListener( "mousedown", function ( event ) {
        if ( event.which === 1 ) {
            lastClientX = event.clientX;
            lastClientY = event.clientY;

            document.addEventListener ( 'mousemove', mouseMoveHandle );
            document.addEventListener ( 'mouseup', mouseUpHandle );

            event.stopPropagation();
        }
    });

    svg.addEventListener( "mousewheel", function ( event ) {
        var scale = Math.pow( 2, event.wheelDelta * 0.002) * camera.scale;
        scale = Math.max( 0.1, Math.min( scale, 100 ) );
        camera.scale = scale;
        txtScale.attr({ 
            text: "camera scale: " + camera.scale
        });
        event.preventDefault();
        event.stopPropagation();
    });

    //
    xaxis = snap.group();
    xaxis.addClass("x-axis");
    yaxis = snap.group();
    yaxis.addClass("y-axis");
    for ( var x = 0; x < width; x += 10 ) {
        var line = snap.line( 0, 0, 0, height );
        line.attr({
            stroke: "#555"
        });
        line.transform("t " + x + " 0");
        xaxis.add(line);
    }
    for ( var y = 0; y < height; y += 10 ) {
        var line = snap.line( 0, 0, width, 0 );
        line.attr({
            stroke: "#555"
        });
        line.transform("t 0 " + y);
        yaxis.add(line);
    }

    //
    label = snap.group();
    label.addClass("label");
    label.add( txtPos );
    label.add( txtScale );

}, false );
</script>

</body>
</html>
